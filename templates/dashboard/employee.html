{% extends "dashboard/base_dashboard.html" %}
{% set role_color = '#6c757d' %}

{% block title %}Employee Dashboard{% endblock %}
{% block dashboard_title %}Employee Dashboard{% endblock %}

{% block dashboard_content %}

<!-- Profile Documents (Employee uploads only here; auto-visible to IT Manager & General Director) -->
<div class="card mb-4">
  <div class="card-header">
    <h5>My Profile Documents</h5>
    <small class="text-muted">Uploads here are visible to IT Manager & General Director.</small>
  </div>
  <div class="card-body">
    <form action="{{ url_for('employee.upload_document') }}" method="POST" enctype="multipart/form-data" class="mb-3">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <!-- fixed folder for employee profile docs -->
      <input type="hidden" name="folder_name" value="Profile">

      <div class="input-group">
        <input type="file" name="document" class="form-control" required>
        <button class="btn btn-primary" type="submit">Upload</button>
      </div>
      <div class="form-text">Example: Passport, National ID, Residence, etc.</div>
    </form>

    {% if documents and documents|length > 0 %}
    <ul class="list-group">
      {% for doc in documents %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
          <strong>{{ doc.filename }}</strong>
          {% if doc.folder_name %}<span class="badge bg-light text-dark ms-2">{{ doc.folder_name }}</span>{% endif %}
          <small class="text-muted ms-2">{{ doc.uploaded_at.strftime('%Y-%m-%d %H:%M') }}</small>
        </div>
        <div class="d-flex gap-2">
          <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('employee.download_document', doc_id=doc.id) }}">Download</a>
          <form action="{{ url_for('employee.delete_document', doc_id=doc.id) }}" method="POST" style="display:inline;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-sm btn-danger">Delete</button>
          </form>
        </div>
      </li>
      {% endfor %}
    </ul>
    {% else %}
    <p class="text-muted">No documents uploaded.</p>
    {% endif %}
  </div>
</div>

<!-- Shared With Me -->
<div class="card mb-4">
  <div class="card-header">
    <h5>Shared With Me</h5>
  </div>
  <div class="card-body">
    {% if shared_documents and shared_documents|length > 0 %}
    <ul class="list-group">
      {% for doc in shared_documents %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
          <strong>{{ doc.filename }}</strong>
          <small class="text-muted ms-2">from {{ doc.user.name }}</small>
          {% if doc.folder_name %}<span class="badge bg-light text-dark ms-2">{{ doc.folder_name }}</span>{% endif %}
        </div>
        <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('employee.download_document', doc_id=doc.id) }}">Download</a>
      </li>
      {% endfor %}
    </ul>
    {% else %}
    <p class="text-muted mb-0">No shared documents yet.</p>
    {% endif %}
  </div>
</div>

<!-- Profile Section (unchanged) -->
<div class="card mb-4">
    <div class="card-header">
        <h5>My Profile</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-8">
                <p><strong>Name:</strong> {{ current_user.name }}</p>
                <p><strong>Email:</strong> {{ current_user.email }}</p>
                <p><strong>Phone:</strong> {{ current_user.phone or 'N/A' }}</p>
                <p><strong>Position:</strong> {{ current_user.position or 'N/A' }}</p>
                <p><strong>Department:</strong> {{ current_user.department.name if current_user.department else 'N/A' }}</p>
                <p><strong>Role:</strong> {{ current_user.role|capitalize }}</p>
                <p><strong>Access Code:</strong> {{ current_user.access_code or 'N/A' }}</p>
            </div>
            <div class="col-md-4 text-center">
                <div class="avatar-circle bg-secondary text-white d-inline-flex align-items-center justify-content-center"
                     style="width: 100px; height: 100px; border-radius: 50%; font-size: 2rem;">
                    {{ current_user.avatar or current_user.name[0]|upper }}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activities -->
<div class="card">
    <div class="card-header">
        <h5>Recent Activities</h5>
    </div>
    <div class="card-body">
        {% include 'dashboard/partials/recent_activities.html' %}
    </div>
</div>

{% endblock %}
